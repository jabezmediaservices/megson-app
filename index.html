<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Megson Pro Cloud</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <style>
        :root { --megson-blue: #003366; --megson-orange: #f39c12; }
        .bg-megson-blue { background-color: var(--megson-blue); }
        .tab-btn.active { color: var(--megson-orange); border-top: 4px solid var(--megson-orange); }
        .logo-font { font-family: 'Arial Black', sans-serif; font-style: italic; letter-spacing: -1px; }
        .logo-img { height: 50px; width: auto; object-fit: contain; }
    </style>
</head>
<body class="bg-gray-100 font-sans pb-32">

    <header class="bg-megson-blue text-white p-4 shadow-lg sticky top-0 z-40 flex justify-between items-center h-24">
        <div class="flex items-center gap-3">
            <div id="header-logo-container"></div>
            <div class="flex flex-col">
                <span class="logo-font text-2xl uppercase leading-none">Megson Plastering</span>
                <span id="header-phone" class="text-sm font-bold text-orange-400 mt-1">PRO SYNC</span>
            </div>
        </div>
        <button onclick="showSection('settings')" id="profile-pic" class="w-12 h-12 rounded-full border-2 border-white/20 overflow-hidden bg-white/10 flex items-center justify-center text-xl">üë§</button>
    </header>

    <section id="sec-jobs" class="p-4 space-y-4">
        <button onclick="openAddModal()" class="w-full bg-megson-blue text-white p-4 rounded-2xl font-black uppercase shadow-lg mb-2">‚ûï New Project</button>
        <div id="job-list-container" class="space-y-4"></div>
    </section>

    <section id="sec-settings" class="p-4 hidden">
        <div class="bg-white p-6 rounded-3xl shadow-md space-y-6">
            <h2 class="text-xl font-black text-megson-blue uppercase italic">Cloud Profile</h2>
            
            <div id="login-area">
                <button onclick="googleLogin()" class="w-full border-2 border-gray-200 p-4 rounded-2xl flex items-center justify-center gap-3 font-bold">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" width="20"> Sign in with Google
                </button>
            </div>

            <div id="user-info" class="hidden">
                <div class="flex items-center gap-3 p-2 bg-blue-50 rounded-2xl mb-4">
                    <img id="user-avatar" class="w-10 h-10 rounded-full">
                    <div>
                        <p id="user-name" class="font-bold text-sm"></p>
                        <p class="text-[10px] text-blue-500 font-black uppercase">Cloud Synced ‚úÖ</p>
                    </div>
                    <button onclick="auth.signOut()" class="ml-auto text-[10px] font-bold text-red-500">Sign Out</button>
                </div>
            </div>

            <hr>
            <h2 class="text-xl font-black text-megson-blue uppercase italic">Invoice Setup</h2>
            <div class="space-y-3">
                <input type="text" id="biz-name" oninput="updateProfile()" placeholder="Business Name" class="w-full border p-4 rounded-2xl">
                <input type="text" id="user-bank" oninput="updateProfile()" placeholder="Bank Details (Acc/Sort)" class="w-full border p-4 rounded-2xl">
            </div>
        </div>
    </section>

    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-4 z-40 h-24">
        <button onclick="showSection('jobs')" class="tab-btn active flex flex-col items-center text-[10px] font-black uppercase"><span class="text-3xl">üìÅ</span>Jobs</button>
        <button onclick="showSection('settings')" class="tab-btn flex flex-col items-center text-[10px] font-black uppercase text-gray-400"><span class="text-3xl">‚öôÔ∏è</span>Profile</button>
    </nav>

    <div id="add-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm">
        <div class="bg-white w-full max-w-lg rounded-3xl p-6 space-y-3">
            <h2 class="text-xl font-black uppercase italic text-megson-blue">New Project</h2>
            <input type="text" id="new-client" class="w-full border p-4 rounded-xl" placeholder="Client Name">
            <input type="text" id="new-addr1" class="w-full border p-3 rounded-xl text-sm" placeholder="Address Line 1">
            <input type="text" id="new-city" class="w-full border p-3 rounded-xl text-sm" placeholder="Town/City">
            <input type="text" id="new-postcode" class="w-full border p-3 rounded-xl text-sm uppercase" placeholder="Postcode">
            <div class="grid grid-cols-2 gap-2">
                <div class="text-[10px] font-bold uppercase text-gray-400">Start Date<input type="date" id="new-start" class="w-full border p-3 rounded-xl text-sm text-black"></div>
                <div class="text-[10px] font-bold uppercase text-gray-400">End Date<input type="date" id="new-end" class="w-full border p-3 rounded-xl text-sm text-black"></div>
            </div>
            <button onclick="createNewJob()" class="w-full bg-megson-blue text-white p-4 rounded-2xl font-black uppercase">Save to Cloud</button>
            <button onclick="closeModal('add-modal')" class="w-full text-gray-400 font-bold">Cancel</button>
        </div>
    </div>

    <script>
        // PASTE YOUR FIREBASE CONFIG HERE
        const firebaseConfig = {
            apiKey: "PASTE_HERE",
            authDomain: "PASTE_HERE",
            projectId: "PASTE_HERE",
            storageBucket: "PASTE_HERE",
            messagingSenderId: "PASTE_HERE",
            appId: "PASTE_HERE"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let appState = { jobs: [], profile: { bizName: "Megson Plastering", bank: "" } };

        // AUTH LOGIC
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('login-area').classList.add('hidden');
                document.getElementById('user-info').classList.remove('hidden');
                document.getElementById('user-name').innerText = user.displayName;
                document.getElementById('user-avatar').src = user.photoURL;
                loadFromCloud(user.uid);
            } else {
                document.getElementById('login-area').classList.remove('hidden');
                document.getElementById('user-info').classList.add('hidden');
            }
        });

        async function googleLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            await auth.signInWithPopup(provider);
        }

        async function saveToCloud() {
            const user = auth.currentUser;
            if (user) await db.collection("users").doc(user.uid).set(appState);
        }

        async function loadFromCloud(uid) {
            const doc = await db.collection("users").doc(uid).get();
            if (doc.exists) { appState = doc.data(); renderJobs(); }
        }

        function createNewJob() {
            const name = document.getElementById('new-client').value;
            const start = document.getElementById('new-start').value;
            const end = document.getElementById('new-end').value;
            
            appState.jobs.push({
                id: Date.now(),
                client: name,
                addr1: document.getElementById('new-addr1').value,
                city: document.getElementById('new-city').value,
                postcode: document.getElementById('new-postcode').value,
                dateFrom: start,
                dateTo: end,
                status: "Pending",
                value: 0
            });
            saveToCloud(); renderJobs(); closeModal('add-modal');
        }

        function calculateDuration(start, end) {
            if(!start || !end) return "TBC";
            const diff = Math.ceil((new Date(end) - new Date(start)) / (1000 * 60 * 60 * 24)) + 1;
            return diff + " Days";
        }

        function renderJobs() {
            const container = document.getElementById('job-list-container');
            container.innerHTML = appState.jobs.map(job => `
                <div class="bg-white p-6 rounded-3xl shadow-sm border-l-[12px] border-gray-300">
                    <h3 class="font-black uppercase text-lg">${job.client}</h3>
                    <p class="text-[10px] text-gray-400 font-bold uppercase">${job.addr1}, ${job.postcode}</p>
                    <div class="flex gap-2 my-2">
                        <span class="bg-blue-50 text-blue-600 px-2 py-1 rounded-lg text-[9px] font-black uppercase">Duration: ${calculateDuration(job.dateFrom, job.dateTo)}</span>
                        <span class="bg-orange-50 text-orange-600 px-2 py-1 rounded-lg text-[9px] font-black uppercase">Quote: ¬£${job.value}</span>
                    </div>
                </div>
            `).join('');
        }

        function openAddModal() { document.getElementById('add-modal').classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        function showSection(id) {
            ['jobs', 'settings'].forEach(s => document.getElementById('sec-' + s).classList.add('hidden'));
            document.getElementById('sec-' + id).classList.remove('hidden');
        }
    </script>
</body>
</html>